<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: monospace;
    background: black;
    color: lime;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #clocks {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
  }
  .clock {
    font-size: 2rem;
    margin: 5px;
  }
  #celebration {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }
  .confetti {
    position: absolute;
    top: -20px;
    will-change: transform;
  }
  @keyframes confetti-fall {
    to {
      transform: translateY(100vh) rotate(720deg);
    }
  }
  #debug {
    margin-top: 20px;
    padding: 6px 12px;
    border: 1px solid lime;
    background: black;
    color: lime;
    cursor: pointer;
  }
  #debugConsole {
    width: 90%;
    height: 150px;
    margin-top: 15px;
    background: black;
    color: lime;
    border: 1px solid lime;
    font-family: monospace;
    font-size: 0.9rem;
    padding: 5px;
    overflow-y: auto;
  }
</style>
</head>
<body>
  <div id="clocks">
    <div class="clock" id="digital24h"></div>
    <div class="clock" id="digital12h"></div>
    <div class="clock" id="digital12hnosec"></div>
    <div class="clock" id="digitalsec"></div>
    <canvas id="analog" width="200" height="200"></canvas>
  </div>
  <div id="celebration"></div>
  <button id="debug">Debug Celebration</button>
  <textarea id="debugConsole" readonly></textarea>
  <script>
    const celebrationEl = document.getElementById('celebration');
    const debugBtn = document.getElementById('debug');
    const debugConsole = document.getElementById('debugConsole');
    const lastTriggered = new Map();
    let celebrationActive = false;

    // === timestamped debug logging ===
    function getTimestamp() {
      const now = new Date();
      return now.toTimeString().split(' ')[0]; // HH:MM:SS
    }
    function logDebug(msg) {
      const line = `[${getTimestamp()}] ${msg}`;
      console.log(line);
      if (debugConsole) {
        debugConsole.value += line + "\n";
        debugConsole.scrollTop = debugConsole.scrollHeight;
      }
    }

    // === NEW: celebration / detection helpers ===
    function angDiff(a,b){
      return Math.abs(((a - b + 180) % 360) - 180);
    }
    function areColinear3(a,b,c,eps=2){
      const ab = angDiff(a,b), ac = angDiff(a,c), bc = angDiff(b,c);
      const close = x => x <= eps || Math.abs(x - 180) <= eps;
      return close(ab) && close(ac) && close(bc);
    }
    function stripCols(s){ return s.replace(/:/g,''); }
    function isPalindrome(s){
      const t = stripCols(s);
      return t === t.split('').reverse().join('');
    }
    function isSymmetrical(s){
      const t = stripCols(s);
      if (t.length % 2 !== 0) return false;
      const half = t.length/2;
      const left = t.slice(0,half);
      const right = t.slice(half);
      return left === right.split('').reverse().join('');
    }
    function isRepeatingPattern(s){
      const t = stripCols(s);
      const n = t.length;
      for (let len = 1; len <= Math.floor(n/2); len++){
        if (n % len !== 0) continue;
        const part = t.slice(0,len);
        if (part.repeat(n/len) === t) return true;
      }
      return false;
    }
    function isRunOfNumbers(s){
      const t = stripCols(s);
      if (t.length < 3) return false;
      for (let i = 1; i < t.length; i++){
        const prev = parseInt(t[i-1],10), cur = parseInt(t[i],10);
        if (Number.isNaN(prev) || Number.isNaN(cur)) return false;
        if (((prev + 1) % 10) !== cur) return false;
      }
      return true;
    }

    // === celebration control ===
    function maybeTrigger(name, value) {
      const prev = lastTriggered.get(name);
      if (prev === value) return;
      lastTriggered.set(name, value);
      logDebug(`${name} => ${value}`);
      if (celebrationActive) {
        logDebug('celebration already active, skipping new trigger');
        return;
      }
      startMinuteCelebration();
    }

    function startMinuteCelebration() {
      if (!celebrationEl || celebrationActive) return;
      celebrationActive = true;
      logDebug('ðŸŽ‰ Celebration started!');
      const interval = 1000;
      const totalDuration = 60 * 1000;
      const endTime = Date.now() + totalDuration;
      let burstCount = 0;
      const loop = setInterval(() => {
        burstCount++;
        triggerCelebration({ count: 24 });
        logDebug(`burst #${burstCount}`);
        if (Date.now() >= endTime) {
          clearInterval(loop);
          celebrationActive = false;
          logDebug('âœ… Celebration ended.');
        }
      }, interval);
    }

    function triggerCelebration({count = 36} = {}) {
      if (!celebrationEl) return;
      const colors = ['#66D1FF','#06d6a0','#4cc9f0','#ff6b6b','#c792ea','#f9c74f'];
      const frag = document.createDocumentFragment();
      for (let i = 0; i < count; i++) {
        const el = document.createElement('div');
        el.className = 'confetti';
        const w = 6 + Math.round(Math.random()*10);
        const h = 10 + Math.round(Math.random()*18);
        el.style.width = w + 'px';
        el.style.height = h + 'px';
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.left = (20 + Math.random() * 60) + '%';
        const delay = Math.random() * 300;
        const duration = 900 + Math.random() * 700;
        el.style.animation = `confetti-fall ${duration}ms cubic-bezier(.2,.7,.2,1) ${delay}ms forwards`;
        el.style.transform = `rotate(${Math.floor(Math.random()*360)}deg)`;
        el.style.transformOrigin = `${Math.random()*100}% ${Math.random()*100}%`;
        frag.appendChild(el);
        setTimeout(() => el.remove(), duration + delay + 100);
      }
      celebrationEl.appendChild(frag);
    }

    // === debug button ===
    if (debugBtn) {
      debugBtn.addEventListener('click', () => {
        logDebug('debug input');
        tick();
        triggerCelebration({count:40});
      });
    }

    // === clocks ===
    function pad2(n){ return n.toString().padStart(2,'0'); }

    function tick() {
