<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: monospace;
    background: black;
    color: lime;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #clocks {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
  }
  .clock {
    font-size: 2rem;
    margin: 5px;
  }
  #celebration {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }
  .confetti {
    position: absolute;
    top: -20px;
    will-change: transform;
  }
  @keyframes confetti-fall {
    to {
      transform: translateY(100vh) rotate(720deg);
    }
  }
  #debug {
    margin-top: 20px;
    padding: 6px 12px;
    border: 1px solid lime;
    background: black;
    color: lime;
    cursor: pointer;
  }
  #debugConsole {
    width: 90%;
    height: 150px;
    margin-top: 15px;
    background: black;
    color: lime;
    border: 1px solid lime;
    font-family: monospace;
    font-size: 0.9rem;
    padding: 5px;
    overflow-y: auto;
  }
</style>
</head>
<body>
  <div id="clocks">
    <div class="clock" id="digital24h"></div>
    <div class="clock" id="digital12h"></div>
    <div class="clock" id="digital12hnosec"></div>
    <div class="clock" id="digitalsec"></div>
    <canvas id="analog" width="200" height="200"></canvas>
  </div>
  <div id="celebration"></div>
  <button id="debug">Debug Celebration</button>
  <textarea id="debugConsole" readonly></textarea>
  <script>
    const celebrationEl = document.getElementById('celebration');
    const debugBtn = document.getElementById('debug');
    const debugConsole = document.getElementById('debugConsole');
    const lastTriggered = new Map();
    let celebrationActive = false;

    function getTimestamp() {
      const now = new Date();
      return now.toTimeString().split(' ')[0]; // HH:MM:SS
    }

    function logDebug(msg) {
      const stamp = getTimestamp();
      const line = `[${stamp}] ${msg}`;
      console.log(line);
      if (debugConsole) {
        debugConsole.value += line + "\n";
        debugConsole.scrollTop = debugConsole.scrollHeight;
      }
    }

    function maybeTrigger(name, value, opts = {}) {
      const prev = lastTriggered.get(name);
      if (prev === value) return;
      lastTriggered.set(name, value);
      logDebug(`${name} => ${value}`);

      if (celebrationActive) {
        logDebug('celebration already active, skipping new trigger');
        return;
      }
      startMinuteCelebration();
    }

    // Run celebration for 1 full minute (repeated bursts)
    function startMinuteCelebration() {
      if (!celebrationEl || celebrationActive) return;
      celebrationActive = true;
      logDebug('ðŸŽ‰ Celebration started!');

      const interval = 1000; // one burst per second
      const totalDuration = 60 * 1000; // one minute
      const endTime = Date.now() + totalDuration;

      const loop = setInterval(() => {
        triggerCelebration({ count: 24 }); // smaller bursts each second
        if (Date.now() >= endTime) {
          clearInterval(loop);
          celebrationActive = false;
          logDebug('âœ… Celebration ended.');
        }
      }, interval);
    }

    // simple confetti burst
    function triggerCelebration({count = 36} = {}) {
      if (!celebrationEl) return;
      const colors = ['#66D1FF','#06d6a0','#4cc9f0','#ff6b6b','#c792ea','#f9c74f'];
      const frag = document.createDocumentFragment();
      for (let i = 0; i < count; i++) {
        const el = document.createElement('div');
        el.className = 'confetti';
        const w = 6 + Math.round(Math.random()*10);
        const h = 10 + Math.round(Math.random()*18);
        el.style.width = w + 'px';
        el.style.height = h + 'px';
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.left = (20 + Math.random() * 60) + '%';
        const delay = Math.random() * 300;
        const duration = 900 + Math.random() * 700;
        el.style.animation = `confetti-fall ${duration}ms cubic-bezier(.2,.7,.2,1) ${delay}ms forwards`;
        el.style.transform = `rotate(${Math.floor(Math.random()*360)}deg)`;
        el.style.transformOrigin = `${Math.random()*100}% ${Math.random()*100}%`;
        frag.appendChild(el);
        setTimeout(() => el.remove(), duration + delay + 100);
      }
      celebrationEl.appendChild(frag);
    }

    // debug button: still just a single burst
    if (debugBtn) {
      debugBtn.addEventListener('click', () => {
        logDebug('debug input');
        tick();
        triggerCelebration({count:40}); // single burst for testing
        if (debugBtn.animate) {
          debugBtn.animate(
            [{ transform: 'scale(1)' }, { transform: 'scale(0.96)' }, { transform: 'scale(1)' }],
            { duration: 180, easing: 'ease-out' }
          );
        }
      });
    }

    function pad2(n) { return n.toString().padStart(2, '0'); }

    function tick() {
      const now = new Date();
      const h24 = pad2(now.getHours());
      const h12 = pad2(((now.getHours() + 11) % 12) + 1);
      const m = pad2(now.getMinutes());
      const s = pad2(now.getSeconds());
      const digital24h = `${h24}:${m}:${s}`;
      const digital12h = `${h12}:${m}:${s}`;
      const digital12hnosec = `${h12}:${m}`;
      const digitalsec = `${s}`;

      document.getElementById('digital24h').textContent = digital24h;
      document.getElementById('digital12h').textContent = digital12h;
      document.getElementById('digital12hnosec').textContent = digital12hnosec;
      document.getElementById('digitalsec').textContent = digitalsec;

      // check patterns
      checkRuns('digital24h', digital24h);
      checkRuns('digital12h', digital12h);
      checkRuns('digital12hnosec', digital12hnosec);
      checkRuns('digitalsec', digitalsec);

      drawAnalog(now);
    }

    function checkRuns(name, str) {
      // Example triggers:
      if (/^(\d)\1:\1\1/.test(str)) {
        maybeTrigger(name, 'all-same');
      }
      if (/(\d):\1/.test(str)) {
        maybeTrigger(name, 'palindrome');
      }
      if (/12:34/.test(str)) {
        maybeTrigger(name, '1234');
      }
    }

    function drawAnalog(now) {
      const ctx = document.getElementById('analog').getContext('2d');
      const w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.clearRect(0, 0, w, h);
      ctx.save();
      ctx.translate(w/2, h/2);
      ctx.strokeStyle = 'lime';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.arc(0, 0, w/2 - 5, 0, 2*Math.PI);
      ctx.stroke();
      const sec = now.getSeconds();
      const min = now.getMinutes();
      const hr = now.getHours();
      drawHand(ctx, (hr%12)/12 * 2*Math.PI, w*0.2);
      drawHand(ctx, min/60 * 2*Math.PI, w*0.3);
      drawHand(ctx, sec/60 * 2*Math.PI, w*0.4);
      ctx.restore();
    }

    function drawHand(ctx, angle, length) {
      ctx.save();
      ctx.rotate(angle - Math.PI/2);
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(length,0);
      ctx.stroke();
      ctx.restore();
    }

    setInterval(tick, 1000);
    tick();
  </script>
</body>
</html>
